var S=Object.create;var a=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var D=Object.getPrototypeOf,M=Object.prototype.hasOwnProperty;var B=(e,t)=>{for(var n in t)a(e,n,{get:t[n],enumerable:!0})},u=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of k(t))!M.call(e,r)&&r!==n&&a(e,r,{get:()=>t[r],enumerable:!(o=L(t,r))||o.enumerable});return e};var m=(e,t,n)=>(n=e!=null?S(D(e)):{},u(t||!e||!e.__esModule?a(n,"default",{value:e,enumerable:!0}):n,e)),F=e=>u(a({},"__esModule",{value:!0}),e);var I={};B(I,{default:()=>C});module.exports=F(I);var v=m(require("fs")),s=m(require("path")),h=require("@parcel/plugin");var l=typeof globalThis.process<"u"?globalThis.process.argv:[];var _=()=>typeof globalThis.process<"u"?globalThis.process.env:{};var w=new Set(l),y=e=>w.has(e),G=l.filter(e=>e.startsWith("--")&&e.includes("=")).map(e=>e.split("=")).reduce((e,[t,n])=>(e[t]=n,e),{});var K=y("--dry-run"),g=()=>y("--verbose")||_().VERBOSE==="true",X=g();var N=(e="",...t)=>console.log(e.padEnd(9),"|",...t);var W=0,R=(...e)=>g()&&N(`\u{1F7E1} ${W++}`,...e);var f=["page-runtime","script-runtime","background-service-runtime"];var T=f.reduce((e,t)=>({...e,[t]:v.default.readFileSync(s.default.join(__dirname,`./runtimes/${t}.js`),"utf8")}),{}),C=new h.Runtime({async loadConfig({config:e}){let t=await e.getConfigFrom((0,s.join)(process.env.PLASMO_PROJECT_DIR,"lab"),["package.json"],{exclude:!0}).then(o=>o?.contents);return{hasReact:!!t?.dependencies?.react||!!t?.devDependencies?.react||!!t?.peerDependencies?.react}},apply({bundle:e,options:t,config:n,bundleGraph:o}){if(e.name==="manifest.json"){if(e.getMainEntry()?.meta.webextEntry!==!0)return;let d=[];return o.traverseBundles(A=>{d.push(A.id)},e),{filePath:__filename,code:JSON.stringify(d),isEntry:!0}}if(e.type!=="js"||!t.hmrOptions||e.env.isLibrary||e.env.isWorklet()||t.mode!=="development"||e.env.sourceType==="script")return;let r=e.getMainEntry()?.filePath;if(!r)return;let b=r.includes(".plasmo"),i=r.startsWith((0,s.join)(process.env.PLASMO_SRC_DIR,"background"))||r.endsWith((0,s.join)("static","background","index.ts"))||r.endsWith("plasmo-default-background.ts");if(!(b||i||r.startsWith((0,s.join)(process.env.PLASMO_SRC_DIR,"content"))))return;let x=n.hasReact&&r.endsWith(".tsx"),P=(0,s.basename)(r).split(".")[0],c=(0,s.dirname)(r).endsWith("contents")||P==="content";if(process.env.__PLASMO_FRAMEWORK_INTERNAL_NO_CS_RELOAD==="true"&&c)return;let p=i?"background-service-runtime":c?"script-runtime":"page-runtime";R("@plasmohq/parcel-runtime","Injecting <<",p,">> for",e.displayName,e.id,r);let E={isContentScript:c,isBackground:i,isReact:x,runtimes:[p],...t.hmrOptions,entryFilePath:String.raw`${r}`,bundleId:e.id,envHash:e.env.id,verbose:process.env.VERBOSE,secure:!!(t.serveOptions&&t.serveOptions.https),serverPort:t.serveOptions&&t.serveOptions.port},O=T[p].replace("__plasmo_runtime_data__",JSON.stringify(E));return{filePath:__filename,code:O,isEntry:!0,env:{sourceType:"module"}}}});
