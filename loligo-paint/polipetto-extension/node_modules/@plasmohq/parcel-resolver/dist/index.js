var B=Object.create;var v=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var K=Object.getPrototypeOf,U=Object.prototype.hasOwnProperty;var X=(t,e)=>{for(var o in e)v(t,o,{get:e[o],enumerable:!0})},w=(t,e,o,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of H(e))!U.call(t,s)&&s!==o&&v(t,s,{get:()=>e[s],enumerable:!(n=G(e,s))||n.enumerable});return t};var E=(t,e,o)=>(o=t!=null?B(K(t)):{},w(e||!t||!t.__esModule?v(o,"default",{value:t,enumerable:!0}):o,t)),q=t=>w(v({},"__esModule",{value:!0}),t);var nt={};X(nt,{default:()=>st});module.exports=q(nt);var V=require("@parcel/plugin");var c=require("path");var F=require("fs"),i=require("path"),L=E(require("fast-glob")),M=require("fs-extra");var R=typeof globalThis.process<"u"?globalThis.process.argv:[];var d=()=>typeof globalThis.process<"u"?globalThis.process.env:{},Q=/\$([\w+]+)/gm,S=(t,e=d(),o=Q)=>t.replace(o,(n,s)=>e[s]||n);var Y=new Set(R),b=t=>Y.has(t),mt=R.filter(t=>t.startsWith("--")&&t.includes("=")).map(t=>t.split("=")).reduce((t,[e,o])=>(t[e]=o,t),{});var ut=b("--dry-run"),x=()=>b("--verbose")||d().VERBOSE==="true",ft=x();var Z=(t="",...e)=>console.log(t.padEnd(9),"|",...e);var tt=0,g=(...t)=>x()&&Z(`\u{1F7E1} ${tt++}`,...t);var m=require("path"),D=t=>t.replaceAll(m.win32.sep,m.posix.sep);var l=[".ts",".tsx",".svelte",".vue",".json"],C=new Set(l),r={got:null,dotPlasmoDirectory:null,remoteCacheDirectory:null,polyfillMap:null,aliasMap:null},A=async t=>{if(r.got===null&&(r.got=(await import("got")).default),r.dotPlasmoDirectory||(r.dotPlasmoDirectory=(0,i.resolve)(process.env.PLASMO_PROJECT_DIR,".plasmo")),r.remoteCacheDirectory||(r.remoteCacheDirectory=(0,i.resolve)(r.dotPlasmoDirectory,"cache","remote-code"),await t.options.inputFS.exists(r.remoteCacheDirectory)||(g("Reinitializing remote cache directory"),await t.options.inputFS.mkdirp(r.remoteCacheDirectory))),!r.polyfillMap){let e=(0,i.join)(__dirname,"polyfills"),o=await(0,L.default)("**/*.js",{cwd:e,onlyFiles:!0});r.polyfillMap=new Map(o.map(n=>[D(n.slice(0,-3)),(0,i.join)(e,n)]))}if(!r.aliasMap){let e=await(0,M.readJson)((0,i.resolve)(process.env.PLASMO_PROJECT_DIR,"package.json"));r.aliasMap=new Map(Object.entries(e.alias||{}))}},u=async(t,e=l,o={})=>{let n=e.flatMap(s=>[`${t}${s}`,(0,i.resolve)(t,`index${s}`)]);for(let s of n)try{if((0,F.statSync)(s).isFile())return{filePath:s,...o}}catch{}return null};async function O({specifier:t,dependency:e}){if(t[0]!=="/"||(0,c.isAbsolute)(t))return null;let o=(0,c.resolve)(process.env.PLASMO_PROJECT_DIR,t.slice(1));if((0,c.extname)(o).length>0)return{filePath:o};let s=(0,c.extname)(e.resolveFrom),a=[s,...l.filter(f=>f!==s)];return u(o,a)}var $=require("path");var _=require("fs"),y=require("fs/promises");async function et(t,e){try{return await(0,y.access)(t,e),!0}catch{return!1}}async function T(t){return et(t,_.constants.R_OK)}async function k({specifier:t}){if(!r.aliasMap.has(t))return null;let e=(0,$.resolve)(r.aliasMap.get(t));return await T(e)?{filePath:e,priority:"sync"}:null}var P=require("path");var ot=(t="",e="",o="")=>{if(!t.startsWith(e))return null;let[n,s]=t.split(e);return u((0,P.resolve)(o,s))};async function I({specifier:t}){return ot(t,"@plasmo-static-common/",(0,P.resolve)(r.dotPlasmoDirectory,"static","common"))}async function W({specifier:t}){return r.polyfillMap.has(t)?{filePath:r.polyfillMap.get(t),priority:"sync"}:null}var j=require("path"),N=require("@parcel/hash");var rt=async(t,e)=>t.origin==="https://www.googletagmanager.com"?e.replace(/http:/g,"chrome-extension:"):e;async function J({specifier:t,dependency:e,options:o}){if(!t.startsWith("https://")||!l.some(a=>e.sourcePath.endsWith(a)))return null;let n=new URL(S(t)),s=n.searchParams.get("plasmo-ext")||"js";try{let a=(0,j.resolve)(r.remoteCacheDirectory,`${(0,N.hashString)(t)}.${s}`),f=await r.got(n.toString()).text(),h=await rt(n,f);return await o.inputFS.rimraf(a),await o.inputFS.writeFile(a,h,{mode:436}),g(`Caching HTTPS dependency: ${t}`),{priority:"lazy",sideEffects:!0,filePath:a}}catch(a){return{diagnostics:[{message:`Cannot download the resource from ${t}`,hints:[a.message]}]}}}var p=require("path");async function z({pipeline:t,specifier:e,dependency:o}){if(e[0]!=="~")return null;let n=(0,p.resolve)((0,p.join)(process.env.PLASMO_SRC_DIR,e.slice(1)));if(t==="data-text"||t==="data-base64"||t==="data-env"||t==="data-text-env"||t==="raw"||t==="raw-env")return{filePath:n};let s=(0,p.extname)(n);if(s.length>0&&C.has(s))return{filePath:n};let a=(0,p.extname)(o.resolveFrom),f=[a,...l.filter(h=>h!==a)];return u(n,f)}var st=new V.Resolver({async resolve(t){return await A(t),await k(t)||await I(t)||await W(t)||await J(t)||await z(t)||await O(t)||null}});
