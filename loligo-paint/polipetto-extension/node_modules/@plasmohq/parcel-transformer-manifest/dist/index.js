var ke=Object.create;var M=Object.defineProperty;var Me=Object.getOwnPropertyDescriptor;var De=Object.getOwnPropertyNames;var je=Object.getPrototypeOf,Le=Object.prototype.hasOwnProperty;var Ee=(e,o)=>{for(var s in o)M(e,s,{get:o[s],enumerable:!0})},F=(e,o,s,r)=>{if(o&&typeof o=="object"||typeof o=="function")for(let a of De(o))!Le.call(e,a)&&a!==s&&M(e,a,{get:()=>o[a],enumerable:!(r=Me(o,a))||r.enumerable});return e};var V=(e,o,s)=>(s=e!=null?ke(je(e)):{},F(o||!e||!e.__esModule?M(s,"default",{value:e,enumerable:!0}):s,e)),Re=e=>F(M({},"__esModule",{value:!0}),e);var Je={};Ee(Je,{default:()=>He});module.exports=Re(Je);var ve=require("@mischnic/json-sourcemap"),Se=require("@parcel/plugin"),we=require("@parcel/utils");var O=typeof globalThis.process<"u"?globalThis.process.argv:[];var N=()=>typeof globalThis.process<"u"?globalThis.process.env:{},Ve=/\$([\w+]+)/gm,B=(e,o=N(),s=Ve)=>e.replace(s,(r,a)=>o[a]||r);var Oe=new Set(O),C=e=>Oe.has(e),Ye=O.filter(e=>e.startsWith("--")&&e.includes("=")).map(e=>e.split("=")).reduce((e,[o,s])=>(e[o]=s,e),{});var Ze=C("--dry-run"),A=()=>C("--verbose")||N().VERBOSE==="true",et=A();var U=(e="",...o)=>console.log(e.padEnd(9),"|",...o);var D=(...e)=>U("\u{1F7E0} WARN",...e),Ne=0,_=(...e)=>A()&&U(`\u{1F7E1} ${Ne++}`,...e);var W=require("@parcel/diagnostic");var v=require("path"),Ae=(e,o,s,r)=>{let a={extraAssets:[],program:o,hmrOptions:r.hmrOptions,hot:!!r.hmrOptions,fs:e.fs,filePath:e.filePath,ptrs:s,asset:e,env:r.env,_isMV2:o.manifest_version===2},i=(0,v.dirname)(e.filePath),n=(0,v.resolve)(i,".."),c=(0,v.resolve)(n,"assets");return{...a,srcDir:process.env.PLASMO_SRC_DIR,dotPlasmoDir:i,projectDir:n,assetsDir:c,getAssets:()=>[...a.extraAssets,e]}},$={},p=()=>$,I=async(...e)=>{$=Ae(...e)},j=e=>$._isMV2;async function H(){let{program:e,filePath:o,ptrs:s,asset:r}=p(),a=j(e),i=a?"browser_action":"action",n=a?e.browser_action:e.action;n&&n.theme_icons&&(n.theme_icons=n.theme_icons.map((c,d)=>{for(let f of["light","dark"]){let u=(0,W.getJSONSourceLocation)(s[`/${i}/theme_icons/${d}/${f}`],"value");c[f]=r.addURLDependency(c[f],{loc:{...u,filePath:o}})}return c}))}var X=require("@parcel/diagnostic");var z=V(require("content-security-policy-parser")),J="'unsafe-eval'";function L(e,o=J){let s=o===J?"'self' blob: filesystem:":"'self'";if(e){let r=(0,z.default)(e);e="",r["script-src"]||(r["script-src"]=[s]),r["script-src"].includes(o)||r["script-src"].push(o),r.sandbox&&!r.sandbox.includes("allow-scripts")&&r.sandbox.push("allow-scripts");for(let a in r)e+=`${a} ${r[a].join(" ")};`;return e}else return`script-src ${s} ${o};object-src ${s};`}var K=()=>{let{program:e}=p();j(e)?$e(e):Te(e)},G="../runtime/plasmo-default-background.ts";function $e(e){Q(e),Be(e)}function Te(e){let{env:o}=p();if(o.PLASMO_BROWSER==="firefox"||o.PLASMO_BROWSER==="gecko"){qe(e);return}Fe(e),Y(e)}function qe(e){let o=e;e.background?.service_worker&&(o.background={scripts:[e.background.service_worker]}),Q(o),Y(e)}function Q(e){let{hot:o,asset:s}=p();e.background?.scripts&&(_("Handling MV2 background scripts"),e.background.scripts=e.background.scripts.map(r=>s.addURLDependency(r,{bundleBehavior:"isolated",needsStableName:!0}))),o&&(e.background?.scripts||(e.background={scripts:[s.addURLDependency(G,{resolveFrom:__filename})]}))}function Fe(e){let{hot:o,asset:s,filePath:r,ptrs:a}=p();e.background?.service_worker&&(_("Handling MV3 background service worker"),e.background.service_worker=s.addURLDependency(e.background.service_worker,{bundleBehavior:"isolated",needsStableName:!0,loc:{filePath:r,...(0,X.getJSONSourceLocation)(a["/background/service_worker"],"value")},env:{context:"web-worker"}}),e.background.type&&delete e.background.type),o&&(e.background||(e.background={service_worker:s.addURLDependency(G,{resolveFrom:__filename,env:{context:"web-worker"}})}))}function Be(e){let{hot:o}=p();o&&(e.content_security_policy=L(e.content_security_policy))}function Y(e){let{hot:o}=p();if(o){let s=e.content_security_policy||{};s.extension_pages=L(s.extension_pages,"http://localhost"),s.sandbox&&(s.sandbox=L(s.sandbox)),e.content_security_policy=s}}var Z=require("@parcel/diagnostic");function ee(){let{program:e,asset:o,filePath:s,ptrs:r}=p();if(e.content_scripts)for(let a=0;a<e.content_scripts.length;++a){let i=e.content_scripts[a];for(let n of["css","js"]){let c=i[n]||[];for(let d=0;d<c.length;++d)c[d]=o.addURLDependency(c[d],{bundleBehavior:"isolated",loc:{filePath:s,...(0,Z.getJSONSourceLocation)(r[`/content_scripts/${a}/${n}/${d}`],"value")}})}}}var te=require("@parcel/diagnostic");async function oe(){let{program:e,filePath:o,ptrs:s,asset:r}=p();if(!e.declarative_net_request)return;let a=e.declarative_net_request.rule_resources;a&&(e.declarative_net_request.rule_resources=a.map((i,n)=>(i.path=r.addURLDependency(i.path,{pipeline:"raw-env",loc:{filePath:o,...(0,te.getJSONSourceLocation)(s[`/declarative_net_request/rule_resources/${n}/path`],"value")}}),i)))}var T=require("path"),q=require("@parcel/diagnostic");var Ce=[["icons"],["browser_action","default_icon"],["browser_action","default_popup"],["page_action","default_icon"],["page_action","default_popup"],["action","default_icon"],["action","default_popup"],["chrome_url_overrides"],["devtools_page"],["options_ui","page"],["sidebar_action","default_icon"],["sidebar_action","default_panel"],["side_panel","default_path"],["storage","managed_schema"],["theme","images","theme_frame"],["theme","images","additional_backgrounds"],["user_scripts","api_script"]],se=()=>{let{program:e,filePath:o,ptrs:s,asset:r}=p(),a=Ce.map(i=>[i,"/"+i.join("/")]).filter(([i,n])=>!!s[n]);for(let[i,n]of a){let c=i.length-1,d=i[c],f=i.reduce((b,g,P)=>P===c?b:b[g],e),u=f[d];if(_(`Adding ${d}`),typeof u=="string"){let b=(0,T.extname)(u);f[d]=r.addURLDependency(u,{bundleBehavior:"isolated",loc:{filePath:o,...(0,q.getJSONSourceLocation)(s[n],"value")},needsStableName:b===".html",pipeline:b===".json"?"raw-env":void 0})}else for(let b of Object.keys(u)){let g=(0,T.extname)(u[b]);u[b]=r.addURLDependency(u[b],{bundleBehavior:"isolated",loc:{filePath:o,...(0,q.getJSONSourceLocation)(s[n+"/"+b],"value")},needsStableName:g===".html",pipeline:g===".json"?"raw-env":void 0})}}};var re=V(require("path")),E=V(require("@parcel/diagnostic"));function ae(){let{program:e,ptrs:o,filePath:s,asset:r}=p();if(e.dictionaries)for(let a in e.dictionaries){let i=(0,E.getJSONSourceLocation)(o[`/dictionaries/${a}`],"value"),n={filePath:s,...i},c=e.dictionaries[a];if(re.default.extname(c)!==".dic")throw new E.default({diagnostic:[{message:"Invalid Web Extension manifest",origin:"@plasmohq/parcel-transformer-manifest",codeFrames:[{filePath:s,codeHighlights:[{...i,message:"Dictionaries must be .dic files"}]}]}]});e.dictionaries[a]=r.addURLDependency(c,{needsStableName:!0,loc:n}),r.addURLDependency(c.slice(0,-4)+".aff",{needsStableName:!0,loc:n})}}var y=require("path");var ie=async(e,o,s="json",r=[])=>{let{asset:a,fs:i,extraAssets:n}=p(),c=await i.readFile(e,"utf8"),d=B(c);n.push({type:s,uniqueKey:o,content:d,bundleBehavior:"isolated",isBundleSplittable:s!=="json",env:a.env,dependencies:r,meta:{bundlePath:o,webextEntry:!1}})},ne=e=>{process.env.__PLASMO_FRAMEWORK_INTERNAL_WATCHER_STARTED||D(e)};async function ce(){let{program:e,asset:o,assetsDir:s,projectDir:r}=p(),a=[(0,y.resolve)(r,"locales"),(0,y.resolve)(s,"locales"),(0,y.resolve)(s,"_locales")].find(c=>o.fs.existsSync(c));if(!a)return;let i=await o.fs.readdir(a);if(i.length===0){_("No locale found, skipping");return}if(e.default_locale||(e.default_locale=i[0],ne(`default_locale not set, fallback to ${i[0]}`)),!await o.fs.exists((0,y.resolve)(a,e.default_locale,"messages.json"))){D("Default locale message.json not found, skipping locale!"),delete e.default_locale;return}await Promise.all(i.map(async c=>{_(`Adding locale ${c}`);let d=(0,y.resolve)(a,c,"messages.json");if(await o.fs.exists(d)){let f=`_locales/${c}/messages.json`;o.invalidateOnFileChange(d),await ie(d,f)}}))}var S=require("path");async function pe(){let{asset:e,srcDir:o,dotPlasmoDir:s,program:r,env:a}=p();if(a.PLASMO_BROWSER==="firefox"||a.PLASMO_BROWSER==="gecko")return;let i=["sandboxes","sandbox.ts","sandbox.tsx"].map(h=>(0,S.resolve)(o,h)),n=(0,S.resolve)(s,"sandboxes"),[c,d,f,u]=await Promise.all([...i,n].map(h=>e.fs.exists(h))),[b]=i,g=[];if(c&&u){let h=await e.fs.readdir(b);h.length>0&&h.forEach(x=>{let k=x.split(".");k.pop(),g.push([x,`${k.join(".")}.html`])})}let P=d||f;!P&&g.length===0||(r.sandbox||(r.sandbox={}),r.sandbox.pages||(r.sandbox.pages=[]),P&&r.sandbox.pages.push(e.addURLDependency("sandbox.html",{needsStableName:!0})),await Promise.all(g.map(async([h,x])=>{let k=(0,S.resolve)(b,h),Pe=(0,S.resolve)(n,x);await e.fs.exists(k)&&await e.fs.exists(Pe)&&(_(`Adding sandbox page: ${h}`),r.sandbox.pages.push(e.addURLDependency(`sandboxes/${x}`,{needsStableName:!0})))})))}var w=require("path");async function le(){let{asset:e,dotPlasmoDir:o,srcDir:s}=p(),r=(0,w.resolve)(s,"tabs"),a=(0,w.resolve)(o,"tabs"),[i,n]=await Promise.all([e.fs.exists(a),e.fs.exists(r)]);if(!i||!n)return;let c=await e.fs.readdir(r);if(c.length===0){_(`No tab found in ${r}, skipping`);return}let d=c.map(f=>{let u=f.split(".");return u.pop(),[f,`${u.join(".")}.html`]});await Promise.all(d.map(async([f,u])=>{let b=(0,w.resolve)(a,u),g=(0,w.resolve)(r,f);await e.fs.exists(b)&&await e.fs.exists(g)&&(_(`Adding tab ${f}`),e.addURLDependency(`./tabs/${u}`,{bundleBehavior:"isolated",needsStableName:!0}))}))}var de=()=>{let{program:e}=p();delete e.$schema};var Ue=e=>e.some(o=>{let s=Number(o);return!isNaN(s)&&s<0&&s>65536}),me=(e,o=3,s="Browser")=>{let r=e.split(".");if(r.length>o)return`${s} versions to have at most ${o} dots`;if(Ue(r))return`${s} versions must be dot-separated integers between 0 and 65535`},ue=e=>me(e,3,"Semantic"),fe=e=>me(e,4,"Browser");var t={type:"string"},m={type:"boolean"},be={type:"object",properties:{},additionalProperties:t},R={browser_style:m,chrome_style:m,default_icon:{oneOf:[be,t]},default_popup:t,default_title:t},l={type:"array",items:t},ge={type:"object",properties:{...R,default_area:{type:"string",enum:["navbar","menupanel","tabstrip","personaltoolbar"]},theme_icons:{type:"array",items:{type:"object",properties:{light:t,dark:t,size:{type:"number"}},additionalProperties:!1,required:["light","dark","size"]}}},additionalProperties:!1},_e={type:"object",properties:{resources:l,matches:l,extension_ids:l,use_dynamic_url:m},additionalProperties:!1},he={$schema:t,name:t,version:{type:"string",__validate:ue},default_locale:t,description:t,icons:be,author:t,browser_specific_settings:{type:"object",properties:{},additionalProperties:{type:"object",properties:{}}},chrome_settings_overrides:{type:"object",properties:{homepage:t,search_provider:{type:"object",properties:{name:t,keyword:t,favicon_url:t,search_url:t,encoding:t,suggest_url:t,image_url:t,instant_url:t,search_url_post_params:t,suggest_url_post_params:t,image_url_post_params:t,instant_url_post_params:t,alternate_urls:l,prepopulated_id:{type:"number"},is_default:m},additionalProperties:!1,required:["name","search_url"]},startup_pages:l},additionalProperties:!1},chrome_url_overrides:{type:"object",properties:{bookmarks:t,history:t,newtab:t},additionalProperties:!1},commands:{type:"object",properties:{},additionalProperties:{type:"object",properties:{suggested_key:{type:"object",properties:{default:t,mac:t,linux:t,windows:t,chromeos:t,android:t,ios:t},additionalProperties:!1},description:t,global:m},additionalProperties:!1}},content_scripts:{type:"array",items:{type:"object",properties:{matches:l,css:l,js:l,match_about_blank:m,exclude_matches:l,include_globs:l,exclude_globs:l,run_at:{type:"string",enum:["document_idle","document_start","document_end"]},all_frames:m},additionalProperties:!1,required:["matches"]}},declarative_net_request:{type:"object",properties:{rule_resources:{type:"array",items:{type:"object",properties:{id:t,enabled:m,path:t},additionalProperties:!1,required:["id","enabled","path"]}}},additionalProperties:!1,required:["rule_resources"]},devtools_page:t,dictionaries:{type:"object",properties:{},additionalProperties:t},externally_connectable:{type:"object",properties:{ids:l,matches:l,accept_tls_channel_id:m},additionalProperties:!1},file_browser_handlers:{type:"array",items:{type:"object",properties:{id:t,default_title:t,file_filters:l},additionalProperties:!1,required:["id","default_title","file_filters"]}},file_system_provider_capabilities:{type:"object",properties:{configurable:m,multiple_mounts:m,watchable:m,source:{type:"string",enum:["file","device","network"]}},additionalProperties:!1,required:["source"]},homepage_url:t,incognito:{type:"string",enum:["spanning","split","not_allowed"]},key:t,minimum_chrome_version:{type:"string",__validate:fe},oauth2:{type:"object",properties:{client_id:t,scopes:l},additionalProperties:!1},offline_enabled:m,omnibox:{type:"object",properties:{},additionalProperties:t},optional_host_permissions:l,optional_permissions:l,options_ui:{type:"object",properties:{browser_style:m,chrome_style:m,open_in_tab:m,page:t},additionalProperties:!1,required:["page"]},permissions:l,protocol_handlers:{type:"array",items:{type:"object",properties:{protocol:t,name:t,uriTemplate:t},additionalProperties:!1,required:["protocol","name","uriTemplate"]}},requirements:{type:"object",properties:{"3D":{type:"object",properties:{features:l},additionalProperties:!1}}},short_name:t,sidebar_action:{type:"object",properties:{browser_style:R.browser_style,default_icon:R.default_icon,default_panel:t,default_title:t,open_at_install:m},additionalProperties:!1,required:["default_panel"]},storage:{type:"object",properties:{managed_schema:t},additionalProperties:!1},theme:{type:"object",properties:{images:{type:"object",properties:{theme_frame:t,additional_backgrounds:l},additionalProperties:!1},colors:{type:"object",properties:{bookmark_text:t,button_background_active:t,button_background_hover:t,icons:t,icons_attention:t,frame:t,frame_inactive:t,ntp_background:t,ntp_text:t,popup:t,popup_border:t,popup_highlight:t,popup_highlight_text:t,popup_text:t,sidebar:t,sidebar_border:t,sidebar_highlight:t,sidebar_highlight_text:t,sidebar_text:t,tab_background_separator:t,tab_background_text:t,tab_line:t,tab_loading:t,tab_selected:t,tab_text:t,toolbar:t,toolbar_bottom_separator:t,toolbar_field:t,toolbar_field_border:t,toolbar_field_border_focus:t,toolbar_field_focus:t,toolbar_field_highlight:t,toolbar_field_highlight_text:t,toolbar_field_separator:t,toolbar_field_text:t,toolbar_field_text_focus:t,toolbar_text:t,toolbar_top_separator:t,toolbar_vertical_separator:t},additionalProperties:!1},properties:{type:"object",properties:{additional_backgrounds_alignment:l,additional_backgrounds_tiling:{type:"array",items:{type:"string",enum:["no-repeat","repeat","repeat-x","repeat-y"]}}},additionalProperties:!1}},additionalProperties:!1,required:["colors"]},tts_engine:{type:"object",properties:{voices:{type:"array",items:{type:"object",properties:{voice_name:t,lang:t,event_type:{type:"string",enum:["start","word","sentence","marker","end","error"]}},additionalProperties:!1,required:["voice_name","event_type"]}}},additionalProperties:!1},update_url:t,user_scripts:{type:"object",properties:{api_script:t},additionalProperties:!1},version_name:t},ye={type:"object",properties:{...he,manifest_version:{type:"number",enum:[3]},action:ge,background:{type:"object",properties:{service_worker:t,type:{type:"string",enum:["classic","module"]}},additionalProperties:!1,required:["service_worker"]},content_security_policy:{type:"object",properties:{extension_pages:t,sandbox:t},additionalProperties:!1},host_permissions:l,sandbox:{type:"object",properties:{pages:l},additionalProperties:!1},web_accessible_resources:{type:"array",items:{oneOf:[{..._e,required:["resources","matches"]},{..._e,required:["resources","extension_ids"]}]}}},required:["manifest_version","name","version"]},xe={type:"object",properties:{...he,manifest_version:{type:"number",enum:[2]},background:{type:"object",properties:{scripts:l,page:t,persistent:m},additionalProperties:!1},browser_action:ge,content_security_policy:t,page_action:{type:"object",properties:{...R,hide_matches:l,show_matches:l,pinned:m},additionalProperties:!1},sandbox:{type:"object",properties:{pages:l,content_security_policy:t},additionalProperties:!1},web_accessible_resources:l},required:["manifest_version","name","version"]};async function Ie(){de(),await Promise.all([le(),pe(),ce(),H(),oe()]),ee(),ae(),se(),K()}var We=()=>{switch(process.env.__PLASMO_FRAMEWORK_INTERNAL_SOURCE_MAPS){case"inline":return{inline:!0,inlineSources:!0};case"external":return{inline:!1,inlineSources:!1};default:return}},He=new Se.Transformer({async transform({asset:e,options:o}){_("@plasmohq/parcel-transformer-manifest"),e.setEnvironment({context:"browser",outputFormat:e.env.outputFormat==="commonjs"?"global":e.env.outputFormat,engines:{browsers:e.env.engines.browsers},sourceMap:e.env.sourceMap&&We(),includeNodeModules:e.env.includeNodeModules,sourceType:e.env.sourceType,isLibrary:e.env.isLibrary,shouldOptimize:e.env.shouldOptimize,shouldScopeHoist:e.env.shouldScopeHoist});let s=await e.getCode(),r=(0,ve.parse)(s),a=r.data,i=a.manifest_version===3?ye:xe;we.validateSchema.diagnostic(i,{data:a,source:s,filePath:e.filePath},"@plasmohq/parcel-transformer-manifest","Invalid Web Extension manifest"),await I(e,a,r.pointers,o);let n=p();return await Ie(),n.asset.setCode(JSON.stringify(a,null,2)),n.asset.meta.webextEntry=!0,_("+ Finished transforming manifest"),n.getAssets()}});
